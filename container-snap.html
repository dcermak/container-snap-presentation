<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title><code>container-snap</code></title>
<meta name="author" content="Dan ƒåerm√°k"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./node_modules/reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./node_modules/reveal.js/dist/theme/simple.css" id="theme"/>

<link rel="stylesheet" href="./node_modules/@fortawesome/fontawesome-free/css/all.min.css"/>

<link rel="stylesheet" href="./custom-style.css"/>
<link rel="stylesheet" href="./node_modules/reveal.js/plugin/highlight/zenburn.css"/>
<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = './node_modules/reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h2 class="title"><code>container-snap</code></h2>
<p class="subtitle" style="color: Gray;">Atomic Updates from OCI Images using Podman‚Äôs Btrfs Driver</p>
<p class="author">Dan ƒåerm√°k</p>
<div style="float:left"><a href="https://all-systems-go.io/" target="_blank"><img src="./media/all-systems-go-logo.svg" height="80px"/></a></div>
<div style="float:right;font-size:35px;"><p xmlns:dct="http://purl.org/dc/terms/" xmlns:cc="http://creativecommons.org/ns#"><a href="https://creativecommons.org/licenses/by/4.0" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
CC BY 4.0 <i class="fab fa-creative-commons"></i> <i class="fab fa-creative-commons-by"></i></a></p></div>
</section>
<section>
<section id="slide-org07b7f2f">
<h2 id="org07b7f2f">who -u</h2>
<p>
Dan ƒåerm√°k
</p>

<p>
 <div style="float:center">
 <table class="who-table">
 <tr><td><i class="fab fa-suse"></i></td><td> Fullstack Developer @SUSE</td></tr>
 <tr><td><i class="fab fa-fedora"></i></td><td> i3 SIG, Package maintainer</td></tr>
 <tr><td><i class="far fa-heart"></i></td><td> Developer Tools, Testing and Documentation, Home Automation</td></tr>
 <tr></tr>
 <tr></tr>
 <tr><td><i class="fa-solid fa-globe"></i></td><td> <a href="https://dancermak.name/">https://dancermak.name</a></td></tr>
 <tr><td><i class="fab fa-github"></i></td><td> <a href="https://github.com/dcermak/">dcermak</a></td></tr>
 <tr><td><i class="fab fa-mastodon"></i></td><td> <a href="https://mastodon.social/@Defolos">@Defolos@mastodon.social</a></td></tr>
 </table>
 </div>
</p>
</section>
</section>
<section>
<section id="slide-org6c1c3ff">
<h2 id="org6c1c3ff">Atomic Updates</h2>
<aside class="notes">
<ul>
<li>updates applied as a whole or not at all &rarr; prevents breakage at inconvenient
times</li>
<li>also called transactional-updates</li>
<li>often coupled with read-only <code>/</code></li>
<li>many implementations, often image based or A/B upgrades</li>

</ul>

</aside>

<p class="fragment appear">
Updates applied <b>fully</b> or <b>not at all</b>
</p>
</section>
</section>
<section>
<section id="slide-orga1c7588">
<h2 id="orga1c7588">Bootable Containers</h2>
<aside class="notes">
<p>
why care?
</p>
<ul>
<li>do you know how to build a qcow2 image of the top of your head?</li>
<li>but you can build a container image</li>

<li>also <b>distribution infrastructure</b> (registries) is in place!</li>

<li>catch: OCI image format not well suited for disk images</li>

</ul>

</aside>

<p class="fragment appear">
deploy an OS from OCI images
</p>

<p class="fragment appear">
But why ü§î
</p>

<p class="fragment appear">
We all know how to build a container
</p>
</section>
</section>
<section>
<section id="slide-org1f614a9">
<h2 id="org1f614a9">Boot from OCI Images</h2>
<p class="fragment appear">
<img src="./media/bootable-containers.svg" height="500px"/>
</p>
</section>
</section>
<section>
<section id="slide-orgfa16408">
<h2 id="orgfa16408">openSUSE's <code>tukit</code></h2>
<aside class="notes">
<ul>
<li>atomic upgrades via btrfs snapshots</li>
<li>new snapshot: create btrfs snapshot of root subvolume, run operations in there</li>
<li>if update fails, snapshot trashed</li>
<li>used by <code>transactional-update</code> on openSUSE MicroOS/SLE Micro/Aeon/Kalpa/etc.</li>

</ul>

</aside>

<p class="fragment appear">
<img src="./media/tukit.svg" height="500px"/>
</p>
</section>
</section>
<section>
<section id="slide-org50a4b38">
<h2 id="org50a4b38">podman's <code>btrfs</code> storage driver</h2>
<aside class="notes">
<ul>
<li>storage driver for container images</li>
<li>each image is a subvolume</li>
<li>each layer is a snapshot</li>
<li>each image is stored "plain text" on disk in a subvolume &rArr; switch default
subvolume switches <code>/</code></li>

</ul>

</aside>

<p class="fragment appear">
<img src="./media/btrfs-storage-driver.svg" height="500px"/>
</p>
</section>
</section>
<section>
<section id="slide-org33d85af">
<h2 id="org33d85af"><code>container-snap</code></h2>
<aside class="notes">
<ul>
<li>combination of the previous:</li>
<li><code>container-snap</code> creates a custom btrfs store</li>
<li>pull an image and let it store to subvolume</li>
<li>switch to the subvolume</li>
<li>profit $$$</li>

</ul>

</aside>

<p class="fragment appear">
<img src="./media/container-snap.svg" height="500px"/>
</p>
</section>
</section>
<section>
<section id="slide-org094a9a7">
<h2 id="org094a9a7">Demo</h2>
<p>
<video width="1066" height="600" controls><source src="media/container-snap-demo.mp4" type="video/mp4"></video>
</p>
</section>
</section>
<section>
<section id="slide-org09033d9">
<h2 id="org09033d9">Challenges</h2>
<p class="fragment (appear)">
<img src="./media/oops1.png"/>
</p>

<p class="fragment (appear)">
<img src="./media/oops2.png"/>
</p>

<p class="fragment (appear)">
<img src="./media/oops3.png"/>
</p>

<ul>
<li class="fragment appear">long debug &amp; test cycles</li>
<li class="fragment appear"><code>tukit</code> is very <a href="https://github.com/openSUSE/snapper/">snapper</a> &amp; openSUSE specific</li>
<li class="fragment appear">bootloaders are weird</li>

</ul>
</section>
</section>
<section>
<section id="slide-orga0617c6">
<h2 id="orga0617c6">What's left?</h2>
<ul>
<li class="fragment appear">actual testing &amp; usage</li>
<li class="fragment appear">proper <code>/etc/</code> handling (üëâÔ∏è <i class="fa-brands fa-github"></i> <a href="https://github.com/dcermak/bindicate"><code>dcermak/bindicate</code></a>)</li>
<li class="fragment appear">better UX</li>
<li class="fragment appear">proper kernel &amp; bootloader update handling</li>
<li class="fragment appear">real image builder support</li>
<li class="fragment appear">finish support in <code>tukit</code></li>
<li class="fragment appear">garbage collection</li>

</ul>

<p class="fragment appear">
Go to <i class="fa-brands fa-github"></i> <a href="https://github.com/dcermak/container-snap"><code>dcermak/container-snap</code></a> and give it a try!
</p>

<p class="fragment appear">
<img src="./media/qr.svg" height="150px"/>
</p>
</section>
</section>
</div>
</div>
<script src="./node_modules/reveal.js/dist/reveal.js"></script>
<script src="./node_modules/reveal.js/plugin/highlight/highlight.js"></script>
<script src="./node_modules/reveal.js/plugin/notes/notes.js"></script>


<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
plugins: [RevealHighlight, RevealNotes, history],
transition: 'none', hash: true
});

</script>
</body>
</html>
